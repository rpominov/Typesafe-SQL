// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Pg from "../Pg.bs.js";
import * as Curry from "rescript/lib/es6/curry.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as Belt_Result from "rescript/lib/es6/belt_Result.js";
import * as TypeOverrides from "pg/lib/type-overrides";

function $$then(promise, fn) {
  return promise.then(Curry.__1(fn));
}

var client = Pg.Client.make(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined);

beforeAll(function () {
      return client.connect();
    });

afterAll(function () {
      return client.end();
    });

test("Client.query", (function () {
        expect.assertions(1);
        var promise = Pg.query(client, undefined, "SELECT 42 num");
        return promise.then(function (result) {
                    expect(result.rows).toEqual([{
                            num: 42
                          }]);
                    return Promise.resolve(undefined);
                  });
      }));

test("Client.query + params", (function () {
        expect.assertions(1);
        var promise = Pg.query(client, [
              42,
              "text"
            ], "SELECT $1::int num, $2::text str");
        return promise.then(function (result) {
                    expect(result.rows).toEqual([{
                            num: 42,
                            str: "text"
                          }]);
                    return Promise.resolve(undefined);
                  });
      }));

test("Client.queryCb", (function (done) {
        expect.assertions(1);
        return Pg.queryCb(client, undefined, "SELECT 42 num", (function (result) {
                      expect(Belt_Result.getExn(result).rows).toEqual([{
                              num: 42
                            }]);
                      return done();
                    }));
      }));

test("Client.queryCb + params", (function (done) {
        expect.assertions(1);
        return Pg.queryCb(client, [
                    42,
                    "text"
                  ], "SELECT $1::int num, $2::text str", (function (result) {
                      expect(Belt_Result.getExn(result).rows).toEqual([{
                              num: 42,
                              str: "text"
                            }]);
                      return done();
                    }));
      }));

test("Client.queryConf", (function () {
        expect.assertions(1);
        var promise = client.query({
              text: "SELECT 42 num"
            });
        return promise.then(function (result) {
                    expect(result.rows).toEqual([{
                            num: 42
                          }]);
                    return Promise.resolve(undefined);
                  });
      }));

test("Client.queryConf + rowMode:array", (function () {
        expect.assertions(1);
        var promise = client.query({
              rowMode: "array",
              text: "SELECT 42 num"
            });
        return promise.then(function (result) {
                    expect(result.rows).toEqual([[42]]);
                    return Promise.resolve(undefined);
                  });
      }));

test("Client.queryConf + params", (function () {
        expect.assertions(1);
        var promise = client.query({
              values: [
                42,
                "text"
              ],
              text: "SELECT $1::int num, $2::text str"
            });
        return promise.then(function (result) {
                    expect(result.rows).toEqual([{
                            num: 42,
                            str: "text"
                          }]);
                    return Promise.resolve(undefined);
                  });
      }));

test("Client.queryConfCb", (function (done) {
        expect.assertions(1);
        return Pg.queryConfCb(client, {
                    text: "SELECT 42 num"
                  }, (function (result) {
                      expect(Belt_Result.getExn(result).rows).toEqual([{
                              num: 42
                            }]);
                      return done();
                    }));
      }));

test("Custom type parser", (function () {
        expect.assertions(1);
        var typesParser = new TypeOverrides();
        typesParser.setTypeParser(23, (function (str) {
                return "Custom: " + str;
              }));
        var promise = client.query({
              types: typesParser,
              text: "SELECT 42 num, TRUE bool"
            });
        return promise.then(function (result) {
                    expect(result.rows).toEqual([{
                            num: "Custom: 42",
                            bool: true
                          }]);
                    return Promise.resolve(undefined);
                  });
      }));

test("Notification", (function () {
        expect.assertions(2);
        var notification = {
          contents: undefined
        };
        client.once("notification", (function (n) {
                notification.contents = n;
                
              }));
        var promise = Pg.query(client, undefined, "LISTEN foo");
        var promise$1 = promise.then(function (param) {
              return Pg.query(client, undefined, "NOTIFY foo, 'bar'");
            });
        return promise$1.then(function (param) {
                    var n = Belt_Option.getExn(notification.contents);
                    expect(n.channel).toEqual("foo");
                    expect(n.payload).toEqual("bar");
                    return Promise.resolve(undefined);
                  });
      }));

export {
  $$then ,
  client ,
  
}
/* client Not a pure module */
