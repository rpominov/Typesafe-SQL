// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Steps$TypesafeSqlBuilder = require("./Steps.bs.js");
var Promise$TypesafeSqlBuilder = require("./Promise.bs.js");
var DescribeQuery = require("@typesafe-sql/describe-query");

Promise$TypesafeSqlBuilder.doneOk(DescribeQuery.createClient({
          user: "testuser",
          password: "testpassword",
          host: "localhost",
          database: "testdatabase"
        }), (function (client) {
        return Promise$TypesafeSqlBuilder.doneOk(Steps$TypesafeSqlBuilder.Read.read("./src/example.sql"), (function (val) {
                      if (val.TAG === /* Ok */0) {
                        var msg = Steps$TypesafeSqlBuilder.Parse.parse(val._0);
                        if (msg.TAG === /* Ok */0) {
                          var parsed = msg._0;
                          var statements = parsed.map(function (x) {
                                return x.processedStatement;
                              });
                          return Promise$TypesafeSqlBuilder.doneOk(Steps$TypesafeSqlBuilder.Describe.describeMany(client, statements), (function (val) {
                                        if (val.TAG === /* Ok */0) {
                                          return Promise$TypesafeSqlBuilder.doneOk(Steps$TypesafeSqlBuilder.Generate.generate(parsed, val._0, Steps$TypesafeSqlBuilder.Generate.jsonGenerator), (function (val) {
                                                        if (val.TAG === /* Ok */0) {
                                                          console.log(val._0);
                                                        } else {
                                                          console.error(val._0);
                                                        }
                                                        client.terminate();
                                                        
                                                      }));
                                        }
                                        console.error(val._0);
                                        client.terminate();
                                        
                                      }));
                        }
                        console.error(msg._0);
                        client.terminate();
                        return ;
                      }
                      console.error(val._0);
                      client.terminate();
                      
                    }));
      }));

var DescribeQuery$1;

exports.DescribeQuery = DescribeQuery$1;
/*  Not a pure module */
